<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="jquery-3.6.1.min.js"></script>
    <link rel="stylesheet" href="jquery-ui.theme.css">
    <script src="jquery.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="jquery.color-2.2.0.min.js"></script>

    <style>
        body {
            -webkit-font-smoothing: antialiased;
            background-color: #333333;
            color: #CCCCCC;
            font: 15px/22.5px "Helvetica Neue", HelveticaNeue, Helvetica, Arial, sans-serif;
        }

        h2 {
            text-align: center
        }

        h3 {
            text-align: center
        }

        table {
            margin: auto
        }

        tr {
            text-align: center
        }

        th {
            font-weight: bold
        }
    </style>

    <script type="text/javascript">

        const symbols = ["AACO", "GOOG", "CFLT", "MSFT", "WKRP"];


        function runIqTables() {
            getRangeTableData("http://localhost:7076/streams-iq/v2/range")
            updateKeyTableWithList("http://localhost:7076/streams-iq/v1/get/");
        }

        function getRangeTableData(path) {
            $.getJSON(path, function (response) {
                updateRangeTable(response, $('#rangeTable'))
                $('#rangeHeader').animate({color: 'red'}, 500).animate({color: '#CCCCCC'}, 500)
            });
        }

        function updateKeyTableWithList(path) {
            $.each(symbols, function (index, value) {
                $.getJSON(path + value, function (response) {
                    updateKeyTable(response,  $('#keyTable'))
                })
            });
        }

        function updateRangeTable(response, table) {
            $.each(response.result, function (index, element) {
                let key = element.symbol;
                if ($("tr[id='" + key + "_range']").length) {
                    $("td[id='" + key + "_td_range']").text(parseFloat(element.buys + element.sells).toFixed(2))
                } else {
                    let row = $('<tr id="' + key + '_range">');
                    row.append($('<td>' + key + '</td><td id="' + key + '_td_range">' + parseFloat(element.buys + element.sells).toFixed(2) + '</td>'));
                    table.append(row);
                }
            });
        }


        function updateKeyTable(response, table) {
            if (!response.errorMessage) {
                let key = response.result.symbol;
                let row = $("tr[id='" + key + "_key']");
                if (row.length) {
                    $("td[id='" + key + "_td_key']").text(parseFloat(response.result.sells).toFixed(2))
                } else {
                    row = $('<tr id="' + key + '_key">');
                    row.append($('<td>' + key + '</td><td id="' + key + '_td_key">' + parseFloat(response.result.sells).toFixed(2) + '</td>'));
                    table.append(row);
                }
            }
        }

        setInterval(runIqTables, 5000);
    </script>

</head>

<body>

<h2>Kafka Streams IQ Dashboard Application</h2>

<div id="errorDiv" style="display: none">
    <h2 id="errorMessage"></h2>
</div>

<div id="rangeDiv">
    <h3 id="rangeHeader">Total Dollar Volume (v2 Range Query)</h3>
    <table id="rangeTable">
        <tr>
            <th>Symbol</th>
            <th>Total Dollar Volume</th>
        </tr>
    </table>
</div>

<br/>

<div id="keyDiv">
    <h3 id="keyHeader">Sales Transactions by Symbol (v1 Key Query)</h3>
    <table id="keyTable">
        <tr>
            <th>Stock Symbol</th>
            <th>Total Sales Volume</th>
        </tr>
    </table>
</div>


</body>
</html>